<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>æ¡å½¢ç ç”Ÿæˆå·¥å…·</title>
    
    <!-- å¤–éƒ¨ä¾èµ– -->
    <link rel="stylesheet" href="css/element-ui.full.css">
    <script src="js/vue.min.js"></script>
    <script src="js/element-ui.min.js"></script>
    <!-- å¼•å…¥å…¶ä»–å¿…è¦çš„åº“ -->
    <script src="js/jsbarcode.min.js"></script>
    <script src="js/jspdf.min.js"></script>
    <script src="js/filesaver.min.js"></script>
    <script src="js/jszip.min.js"></script>
    <!-- å¼•å…¥Excelå¤„ç†åº“ -->
    <script src="js/xlsx.min.js"></script>
    
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 10px;
            background-color: #f5f7fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            line-height: 1.6;
        }
        
        /* å®¹å™¨æ ·å¼ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1);
            padding: 10px;
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ebeef5;
        }
        
        .header h1 {
            color: #303133;
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .header p {
            color: #909399;
            margin: 0;
            font-size: 16px;
        }
        
        /* è¡¨å•åŒºåŸŸæ ·å¼ */
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-section h3 {
            color: #303133;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 500;
        }
        
        /* æ¡å½¢ç é¡¹ç›®æ ·å¼ */
        .barcode-item {
            border: 1px solid #dcdfe6;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            background: #fafafa;
            transition: all 0.3s ease;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .barcode-item:hover {
            border-color: #c0c4cc;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .barcode-item-content {
            flex: 1;
        }
        
        .barcode-item-preview {
            width: 250px;
            height: 150px;
            border: 1px solid #e9ecef;
            background: white;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .barcode-preview-canvas {
            width: 100%;
            height: 100%;
        }
        
        @media (max-width: 768px) {
            .barcode-item {
                flex-direction: column;
            }
            
            .barcode-item-preview {
                width: 100%;
                height: 120px;
            }
        }
        
        .form-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .form-group {
            display: flex;
            align-items: center;
            margin-right: 5px;
        }
        
        .form-group label {
            margin-right: 5px;
            margin-bottom: 0 !important;
            white-space: nowrap;
            font-weight: 500;
            color: #606266;
            font-size: 14px;
        }
        
        .form-row {
            flex-wrap: nowrap !important;
        }
        
        .form-group:last-child {
            flex: 0 0 auto;
            align-items: center;
        }
        
        /* ä¿¡æ¯åŒºåŸŸæ ·å¼ */
        .info-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e6f3ff 100%);
            border: 1px solid #b3d8ff;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .info-section h3 {
            margin: 0 0 15px 0;
            color: #409eff;
            font-size: 18px;
            font-weight: 600;
        }
        
        .info-section p {
            margin: 8px 0;
            color: #606266;
            font-size: 14px;
        }
        
        .example-link {
            color: #409eff;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .example-link:hover {
            color: #337ecc;
            text-decoration: underline;
        }
        
        /* Canvaså®¹å™¨æ ·å¼ */
        .canvas-container {
            text-align: center;
            margin-top: 20px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .canvas-container h3 {
            color: #303133;
            margin-bottom: 10px;
        }
        
        .canvas-container p {
            color: #909399;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        canvas {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            border: 1px solid #dcdfe6;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* æŒ‰é’®ç»„æ ·å¼ */
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* åŒºåŸŸå¤´éƒ¨æ ·å¼ */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .section-header h3 {
            margin: 0;
            flex: 1;
            min-width: 250px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .form-group {
                min-width: 100%;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 24px;
            }
        }
        
        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        /* Excelæ‹–æ”¾åŒºåŸŸæ´»åŠ¨çŠ¶æ€æ ·å¼ */
        .excel-drop-area-active {
            border-color: #409eff !important;
            background-color: #ecf5ff !important;
        }
        
        .excel-drop-area:hover {
            border-color: #c6e2ff;
            background-color: #f0f9ff;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- åŠ è½½é®ç½© -->
        <div v-if="loading" class="loading-overlay">
            <div style="width: 40px; height: 40px; border: 3px solid #409eff; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        </div>
        
        <div class="container" style="width: 1100px;">
            <!-- å¤´éƒ¨ -->
            <div class="header" style="margin-bottom: 0px;">
                <h1 style="font-size: 36px; margin-bottom: 0px;">æ¡å½¢ç ç”Ÿæˆå·¥å…·</h1>
                <p style="font-size: 13px; margin: 0; line-height: 1.4;">è¾“å…¥FNSKUã€è‡ªå®šä¹‰æ–‡æœ¬ï¼Œç”Ÿæˆæ¡å½¢ç ï¼Œå¯ä¸‹è½½PDFæ–‡ä»¶å’Œå›¾ç‰‡</p>
            </div>

            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="info-section" style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 10px;">
                <!-- å·¦ä¾§ï¼šæ–‡æœ¬è¾“å…¥è¯´æ˜ -->
                <div style="flex: 1; min-width: 280px;">
                    <h3 style="color: #409eff; font-size: 15px; font-weight: 600; margin: 0 0 8px 0;">ğŸ“‹ æ–‡æœ¬è¾“å…¥è¯´æ˜</h3>
                    <p style="font-size: 12px; margin: 0 0 4px 0; line-height: 1.3;"><strong>æ ¼å¼è¯´æ˜ï¼š</strong> FNSKU:è‡ªå®šä¹‰æ–‡æœ¬:æ•°é‡</p>
                    <p style="font-size: 12px; margin: 0 0 4px 0; line-height: 1.3;"><strong>ç¤ºä¾‹ï¼š</strong> X004TELQ11:è‡ªå®šä¹‰æ–‡æœ¬1:10, X004TELQ12:è‡ªå®šä¹‰æ–‡æœ¬2:10</p>
                    <p style="font-size: 12px; margin: 0 0 4px 0; line-height: 1.3;"><strong>æç¤ºï¼š</strong> æ”¯æŒè‹±æ–‡é€—å·(,)å’Œä¸­æ–‡é€—å·(ï¼Œ)</p>
                    <p style="font-size: 12px; margin: 0; line-height: 1.3;"><a href="https://www.6label.com/barcodeDecode?identity=eoqpxh&ref=67tool.com" class="example-link" target="_blank">ğŸ”— æ ¸éªŒé“¾æ¥</a></p>
                </div>
                
                <!-- å³ä¾§ï¼šExcelè¾“å…¥è¯´æ˜ -->
                <div style="flex: 1; min-width: 280px;">
                    <h3 style="color: #409eff; font-size: 15px; font-weight: 600; margin: 0 0 8px 0;">ğŸ“Š Excelè¾“å…¥è¯´æ˜</h3>
                    <p style="font-size: 12px; margin: 0 0 6px 0; line-height: 1.3;"><strong>æ ¼å¼è¯´æ˜ï¼š</strong>æ–‡ä»¶ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªå‚æ•°åï¼š"FNSKU"ã€"è‡ªå®šä¹‰æ–‡æœ¬"ã€"æ•°é‡"ï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œæ¯è¡Œæ˜¯ä¸€æ¡æ•°æ®ã€‚</p>
                    <p style="display: flex; align-items: flex-start; margin: 0;"><strong>ç¤ºä¾‹ï¼š</strong>
                        <span v-if="!excelExampleLoaded" style="cursor: pointer; color: #409eff; text-decoration: underline; margin-left: 5px; font-size: 12px;" @click="loadExcelExample">
                            æŸ¥çœ‹ç¤ºä¾‹
                        </span>
                        <img v-else :src="excelExampleSrc" alt="Excelå¯¼å…¥æ ¼å¼ç¤ºä¾‹" style="max-width: 100%; border: 1px solid #dee2e6; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-left: 5px;"/>
                    </p>
                </div>
            </div>

            <!-- æ‰¹é‡è¾“å…¥è¡¨å• -->
              <div class="form-section">
                  <el-form :model="formData" size="medium">
                      <el-form-item>
                          <div style="display: flex; align-items: center; gap: 15px; width: 100%;">
                              <!-- æ‰¹é‡è¾“å…¥æ ‡é¢˜ -->
                              <h3 style="font-weight: bold; font-size: 16px; margin: 0; white-space: nowrap;">
                                  æ‰¹é‡è¾“å…¥ï¼š
                              </h3>
                              
                              <!-- æ‰¹é‡è¾“å…¥æ–‡æœ¬æ¡† - è°ƒæ•´é«˜åº¦ä¸Excelæ‹–æ”¾åŒºåŸŸç›¸åŒ -->
                               <el-input
                                   type="textarea"
                                   v-model="formData.batchInput"
                                   :rows="6"
                                   placeholder="è¯·è¾“å…¥æ¡å½¢ç ä¿¡æ¯ï¼Œæ ¼å¼ï¼šFNSKU:SKU:æ•°é‡ï¼Œå¤šä¸ªç”¨é€—å·(,æˆ–ï¼Œ)åˆ†éš”"
                                   @input="updateBarcodeItemsFromBatchInput"
                                   style="
                                       flex: 1;
                                       width: 100%;
                                       height: auto;
                                       min-height: 130px;
                                       border: 2px solid #dcdfe6;
                                       border-radius: 6px;
                                       transition: all 0.3s;
                                   "
                                   :style="{ borderColor: isDragging ? '#409eff' : '#dcdfe6' }"
                               >
                               </el-input>
                            
                            <!-- Excelå¯¼å…¥æ‹–æ”¾åŒºåŸŸ -->
                            <div 
                                class="excel-drop-area"
                                @dragover.prevent="handleDragOver"
                                @dragleave="handleDragLeave"
                                @drop.prevent="handleDrop"
                                @click="triggerFileInput"
                                :class="{ 'excel-drop-area-active': isDragging }"
                                style="
                                    width: 50%;
                                    border: 2px dashed #dcdfe6;
                                    border-radius: 6px;
                                    padding: 20px;
                                    display: flex;
                                    flex-direction: column;
                                    justify-content: center;
                                    align-items: center;
                                    cursor: pointer;
                                    background-color: #fafafa;
                                    transition: all 0.3s;
                                "
                            >
                                <i class="el-icon-excel" style="font-size: 48px; color: #409eff; margin-bottom: 10px;"></i>
                                <p style="color: #606266; margin: 0;">æ‹–æ”¾Excelæ–‡ä»¶åˆ°æ­¤å¤„</p>
                                <p style="color: #909399; font-size: 12px; margin-top: 5px;">æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                                <input 
                                    type="file" 
                                    ref="fileInput"
                                    accept=".xlsx,.xls"
                                    style="display: none;"
                                    @change="handleFileSelect"
                                >
                            </div>
                        </div>
                    </el-form-item>
                </el-form>
            </div>

            <!-- æ¡å½¢ç é¡¹ç›®åˆ—è¡¨ -->
            <div class="form-section">
                <div class="section-header">
                    <h3>ğŸ“¦ æ¡å½¢ç é¡¹ç›®åˆ—è¡¨ (å…± {{ barcodeItems.length }} ä¸ª)</h3>
                    <div class="header-buttons">
                        <el-button type="primary" size="small" icon="el-icon-plus" @click="addBarcodeItem">
                            æ·»åŠ å•ä¸ªé¡¹ç›®
                        </el-button>
                        <el-button type="danger" size="small" icon="el-icon-delete" @click="clearAllBarcodeItems">
                            æ¸…ç©ºæ‰€æœ‰
                        </el-button>
                        <el-button type="primary" size="small" icon="el-icon-download" @click="generateAllPDFs" :disabled="barcodeItems.length === 0">
                            ä¸‹è½½PDFæ–‡ä»¶
                        </el-button>
                        <el-button type="primary" size="small" icon="el-icon-picture" @click="downloadAllImages" :disabled="barcodeItems.length === 0">
                            ä¸‹è½½PNGå›¾ç‰‡
                        </el-button>
                    </div>
                </div>
                <div v-if="barcodeItems.length === 0" class="el-empty">
                    <div class="el-empty__image">
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNTMgMTU0Ij48cGF0aCBmaWxsPSIjZTdlZmY3IiBkPSJNMTE2LjQ0MiA3My40NDRjNi4zMzYgMCAxMS41NTggLTUuMjIyIDExLjU1OCAtMTEuNTU4IDAtNi4zMzYtNS4yMjItMTEuNTU4LTExLjU1OC0xMS41NThjLTYuMzM2IDAtMTEuNTU4IDUuMjIyLTExLjU1OCAxMS41NTggMCA2LjMzNiA1LjIyMiAxMS41NTggMTEuNTU4IDExLjU1OHptMCA3OS45MThjMy41NDQgMCA2LjQgMi44NTYgNi40IDYuNGMwIDMuNTQ0LTIuODY3IDYuNC02LjQgNi40Yy0zLjU0NCAwLTYuNC0yLjg1Ni02LjQtNi40IDAtMy41NDQgMi44NjctNi40IDYuNC02LjR6bS01OC4yMjMgMCAwLTU3LjU4YzMuNTQ0IDAgNi40IDIuODY3IDYuNCA2LjRjMCAzLjU0NC0yLjg1NiA2LjQtNi40IDYuNC0zLjU0NCAwLTYuNC0yLjg1Ni02LjQtNi40IDAtMy41NCAyLjg1Ni02LjQgNi40LTYuNHptLTU4LjIyMi0yMi4zNWMwLTYuMzM2LTUuMjIyLTExLjU1OC0xMS41NTgtMTEuNTU4LTYuMzM2IDAtMTEuNTU4IDUuMjIyLTExLjU1OCAxMS41NTggMCA2LjMzNiA1LjIyMiAxMS41NTggMTEuNTU4IDExLjU1OHoiLz48cGF0aCBkPSJNMCAwaDE1M3YxNTRIMHoiLz48L3N2Zz4=">
                    </div>
                    <p class="el-empty__text">æš‚æ— æ•°æ®</p>
                </div>
                <div v-for="(item, index) in barcodeItems" :key="index" class="barcode-item">
                    <div class="barcode-item-content">
                        <div class="form-row" style="display: flex; align-items: center;">
                            <div class="form-group">
                                <label>FNSKU</label>
                                <el-input v-model="item.fnsku" placeholder="è¯·è¾“å…¥FNSKU" @input="updateItemPreview(index); updateBatchInputFromBarcodeItems()" style="width: 180px;"></el-input>
                            </div>
                            <div class="form-group">
                                <label>è‡ªå®šä¹‰æ–‡æœ¬</label>
                                <el-input v-model="item.customTexts" placeholder="è¯·è¾“å…¥è‡ªå®šä¹‰æ–‡æœ¬" @input="updateItemPreview(index); updateBatchInputFromBarcodeItems()" style="width: 220px;"></el-input>
                            </div>
                            <div class="form-group">
                                <label>æ•°é‡<el-tooltip content="æ•°é‡åªåœ¨ä¸‹è½½çš„æ–‡ä»¶åä¸Šä½“ç°ï¼Œæ— å…¶ä»–ä½œç”¨" placement="top"><sup style="color: #409eff; cursor: help; margin-left: 2px;">?</sup></el-tooltip></label>
                                <el-input-number v-model="item.count" :min="1" :max="9999" controls-position="right" @change="updateItemPreview(index); updateBatchInputFromBarcodeItems()" style="width: 100px;"></el-input-number>
                            </div>
                            <div class="form-group">
                                <el-button type="danger" icon="el-icon-delete" circle @click="removeBarcodeItem(index)" style="width: 40px;"></el-button>
                            </div>
                        </div>
                    </div>
                    <div class="barcode-item-preview">
                        <canvas :id="'preview-' + index" class="barcode-preview-canvas" width="500" height="300"></canvas>
                    </div>
                </div>
            </div>




        </div>
    </div>

    <script type="text/javascript">
        // å®‰è£…Element UI
        Vue.use(ELEMENT);
        
        new Vue({
            el: '#app',
            data() {
            return {
                loading: false,
                formData: {
                    batchInput: 'X004TELQ11:è‡ªå®šä¹‰æ–‡æœ¬1:10, X004TELQ12:è‡ªå®šä¹‰æ–‡æœ¬2:10'
                },
                barcodeItems: [
                    {
                        fnsku: '',
                        customTexts: '',
                        count: 1,
                        quantity: 'NEW                 MADE IN CHINA',
                        // ä½ç½®è°ƒæ•´å‚æ•°
                        fnskuX: 0,
                        fnskuY: 0,
                        quantityX: 0,
                        quantityY: 0,
                        // å­—ä½“å¤§å°å‚æ•°
                        fnskuFontSize: 12,
                        quantityFontSize: 11
                    }
                ],
                batchInputUpdateTimer: null,
                isDragging: false,
                // Excelç¤ºä¾‹å›¾ç‰‡æ‡’åŠ è½½ç›¸å…³æ•°æ®
                excelExampleLoaded: false,
                excelExampleSrc: 'data:image/svg+xml;charset=utf-8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="133" viewBox="0 0 400 175"%3E%3Crect x="0" y="0" width="400" height="175" fill="%23f8f9fa" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="10" y="10" width="100" height="30" fill="%23e9ecef" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="110" y="10" width="180" height="30" fill="%23e9ecef" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="290" y="10" width="100" height="30" fill="%23e9ecef" stroke="%23dee2e6" stroke-width="1"/%3E%3Ctext x="60" y="32" font-family="Arial" font-size="14" text-anchor="middle" fill="%23495057"%3EFNSKU%3C/text%3E%3Ctext x="200" y="32" font-family="Arial" font-size="14" text-anchor="middle" fill="%23495057"%3Eè‡ªå®šä¹‰æ–‡æœ¬%3C/text%3E%3Ctext x="340" y="32" font-family="Arial" font-size="14" text-anchor="middle" fill="%23495057"%3Eæ•°é‡%3C/text%3E%3Crect x="10" y="40" width="100" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="110" y="40" width="180" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="290" y="40" width="100" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Ctext x="60" y="58" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3EX004TELO3A%3C/text%3E%3Ctext x="200" y="58" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3Eäº§å“1%3C/text%3E%3Ctext x="340" y="58" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3E1%3C/text%3E%3Crect x="10" y="65" width="100" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="110" y="65" width="180" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="290" y="65" width="100" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Ctext x="60" y="83" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3EX004TELO4A%3C/text%3E%3Ctext x="200" y="83" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3Eäº§å“2%3C/text%3E%3Ctext x="340" y="83" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3E1%3C/text%3E%3Crect x="10" y="90" width="100" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="110" y="90" width="180" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="290" y="90" width="100" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Ctext x="60" y="108" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3EX004TELO5A%3C/text%3E%3Ctext x="200" y="108" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3Eäº§å“3%3C/text%3E%3Ctext x="340" y="108" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3E1%3C/text%3E%3Crect x="10" y="115" width="100" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="110" y="115" width="180" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="290" y="115" width="100" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Ctext x="60" y="133" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3EX004TELO6A%3C/text%3E%3Ctext x="200" y="133" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3Eäº§å“4%3C/text%3E%3Ctext x="340" y="133" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3E1%3C/text%3E%3Crect x="10" y="140" width="100" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="110" y="140" width="180" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Crect x="290" y="140" width="100" height="25" fill="%23ffffff" stroke="%23dee2e6" stroke-width="1"/%3E%3Ctext x="60" y="158" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3EX004TELO7A%3C/text%3E%3Ctext x="200" y="158" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3Eäº§å“5%3C/text%3E%3Ctext x="340" y="158" font-family="Arial" font-size="12" text-anchor="middle" fill="%23495057"%3E1%3C/text%3E%3C/svg%3E'
            }
        },
            mounted() {
                // é¡µé¢åŠ è½½å®Œæˆåéšè—åŠ è½½é®ç½©
                setTimeout(() => {
                    this.loading = false;
                    // åˆå§‹åŒ–é¢„è§ˆ
                    this.barcodeItems.forEach((_, index) => {
                        this.updateItemPreview(index);
                    });
                    
                    // åˆå§‹åŒ–æ—¶ç¡®ä¿æ‰¹é‡è¾“å…¥æ¡†å’Œæ¡å½¢ç é¡¹ç›®åˆ—è¡¨åŒæ­¥
                    this.updateBarcodeItemsFromBatchInput()
                }, 500);
            },
            methods: {
                // åŠ è½½Excelç¤ºä¾‹å›¾ç‰‡
                loadExcelExample() {
                    this.excelExampleLoaded = true;
                },
                
                // æ·»åŠ å•ä¸ªæ¡å½¢ç é¡¹ç›®
                addBarcodeItem() {
                    this.barcodeItems.push({
                        fnsku: '',
                        customTexts: '',
                        count: 1,
                        quantity: 'NEW                 MADE IN CHINA',
                        fnskuX: 0,
                        fnskuY: 0,
                        quantityX: 0,
                        quantityY: 0,
                        fnskuFontSize: 12,
                        quantityFontSize: 11
                    });
                    
                    // å»¶è¿Ÿæ›´æ–°é¢„è§ˆï¼Œç¡®ä¿DOMå·²æ¸²æŸ“
                    setTimeout(() => {
                        const index = this.barcodeItems.length - 1;
                        this.updateItemPreview(index);
                    }, 100);
                    
                    // æ›´æ–°æ‰¹é‡è¾“å…¥æ¡†
                    this.updateBatchInputFromBarcodeItems();
                },
                
                // ç§»é™¤æ¡å½¢ç é¡¹ç›®
                removeBarcodeItem(index) {
                    this.barcodeItems.splice(index, 1);
                    this.updateBatchInputFromBarcodeItems();
                },
                
                // æ¸…ç©ºæ‰€æœ‰æ¡å½¢ç é¡¹ç›®
                clearAllBarcodeItems() {
                    this.$confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é¡¹ç›®å—ï¼Ÿ', 'æç¤º', {
                        confirmButtonText: 'ç¡®å®š',
                        cancelButtonText: 'å–æ¶ˆ',
                        type: 'warning'
                    }).then(() => {
                        this.barcodeItems = [];
                        this.formData.batchInput = '';
                    }).catch(() => {
                        this.$message({
                            type: 'info',
                            message: 'å·²å–æ¶ˆæ“ä½œ'
                        });
                    });
                },
                
                // ä»æ‰¹é‡è¾“å…¥æ›´æ–°æ¡å½¢ç é¡¹ç›®åˆ—è¡¨
                updateBarcodeItemsFromBatchInput() {
                    if (!this.formData.batchInput.trim()) {
                        return;
                    }
                    
                    try {
                        const items = [];
                        // åˆ†å‰²è¾“å…¥å†…å®¹ï¼ˆæ”¯æŒä¸­è‹±æ–‡é€—å·ï¼‰
                        const parts = this.formData.batchInput.split(/[,ï¼Œ]/);
                        
                        parts.forEach(part => {
                            part = part.trim();
                            if (!part) return;
                            
                            // è§£ææ¯è¡Œæ•°æ®ï¼šFNSKU:SKU:æ•°é‡
                            const [fnsku, customTexts, countStr] = part.split(':');
                            
                            if (fnsku && fnsku.trim()) {
                                items.push({
                                    fnsku: fnsku.trim(),
                                    customTexts: customTexts ? customTexts.trim() : '',
                                    count: countStr && !isNaN(parseInt(countStr)) ? parseInt(countStr) : 1,
                                    quantity: 'NEW                 MADE IN CHINA',
                                    fnskuX: 0,
                                    fnskuY: 0,
                                    quantityX: 0,
                                    quantityY: 0,
                                    fnskuFontSize: 12,
                                    quantityFontSize: 11
                                });
                            }
                        });
                        
                        if (items.length > 0) {
                            this.barcodeItems = items;
                            // å»¶è¿Ÿæ›´æ–°é¢„è§ˆï¼Œç¡®ä¿DOMå·²æ¸²æŸ“
                            setTimeout(() => {
                                this.barcodeItems.forEach((_, index) => {
                                    this.updateItemPreview(index);
                                });
                            }, 100);
                        }
                    } catch (error) {
                        console.error('è§£ææ‰¹é‡è¾“å…¥å¤±è´¥:', error);
                        this.$message.error('æ‰¹é‡è¾“å…¥æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥æ ¼å¼ï¼šFNSKU:SKU:æ•°é‡ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”');
                    }
                },
                
                // ä»æ¡å½¢ç é¡¹ç›®åˆ—è¡¨æ›´æ–°æ‰¹é‡è¾“å…¥
                updateBatchInputFromBarcodeItems() {
                    if (this.barcodeItems.length === 0) {
                        this.formData.batchInput = '';
                        return;
                    }
                    
                    // ä½¿ç”¨é˜²æŠ–é¿å…é¢‘ç¹æ›´æ–°
                    if (this.batchInputUpdateTimer) {
                        clearTimeout(this.batchInputUpdateTimer);
                    }
                    
                    this.batchInputUpdateTimer = setTimeout(() => {
                        const lines = this.barcodeItems.map(item => {
                            return `${item.fnsku || ''}:${item.customTexts || ''}:${item.count || 1}`;
                        }).filter(line => line.trim());
                        
                        this.formData.batchInput = lines.join(', ');
                    }, 300);
                },
                
                // Excelå¯¼å…¥ç›¸å…³æ–¹æ³•
                handleDragOver() {
                    this.isDragging = true;
                },
                
                handleDragLeave() {
                    this.isDragging = false;
                },
                
                handleDrop(event) {
                    this.isDragging = false;
                    const file = event.dataTransfer.files[0];
                    if (file) {
                        this.processExcelFile(file);
                    }
                },
                
                triggerFileInput() {
                    this.$refs.fileInput.click();
                },
                
                handleFileSelect(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.processExcelFile(file);
                        // é‡ç½®inputï¼Œä»¥ä¾¿å¯ä»¥é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
                        event.target.value = '';
                    }
                },
                
                processExcelFile(file) {
                    if (!file.name.match(/\.(xls|xlsx)$/)) {
                        this.$message.error('è¯·é€‰æ‹©Excelæ–‡ä»¶(.xlsæˆ–.xlsx)');
                        return;
                    }
                    
                    this.loading = true;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            // è§£æExcelæ–‡ä»¶
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            
                            // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            
                            // è½¬æ¢ä¸ºJSON
                            const jsonData = XLSX.utils.sheet_to_json(worksheet);
                            
                            if (jsonData.length === 0) {
                                this.$message.warning('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®');
                                return;
                            }
                            
                            // æŸ¥æ‰¾FNSKUã€è‡ªå®šä¹‰æ–‡æœ¬ã€æ•°é‡å¯¹åº”çš„åˆ—
                            const headers = Object.keys(jsonData[0]);
                            let fnskuColumn = '';
                            let customTextColumn = '';
                            let countColumn = '';
                            
                            headers.forEach(header => {
                                const headerLower = header.toLowerCase();
                                if (headerLower.includes('fnsku')) {
                                    fnskuColumn = header;
                                } else if (headerLower.includes('è‡ªå®šä¹‰æ–‡æœ¬') || headerLower.includes('sku')) {
                                    customTextColumn = header;
                                } else if (headerLower.includes('æ•°é‡') || headerLower.includes('count')) {
                                    countColumn = header;
                                }
                            });
                            
                            // æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°å¿…è¦çš„åˆ—
                            if (!fnskuColumn) {
                                this.$message.error('æœªæ‰¾åˆ°FNSKUåˆ—ï¼Œè¯·ç¡®ä¿ç¬¬ä¸€è¡ŒåŒ…å«FNSKUæ ‡é¢˜');
                                return;
                            }
                            
                            // å¤„ç†æ•°æ®å¹¶è½¬æ¢ä¸ºæ‰¹é‡è¾“å…¥æ ¼å¼
                            const batchLines = [];
                            jsonData.forEach((row, index) => {
                                // è·³è¿‡æ ‡é¢˜è¡Œï¼ˆå¦‚æœç¬¬ä¸€è¡Œæ˜¯æ ‡é¢˜ï¼‰
                                if (index === 0 && typeof row[fnskuColumn] === 'string' && 
                                    row[fnskuColumn].toLowerCase().includes('fnsku')) {
                                    return;
                                }
                                
                                const fnsku = row[fnskuColumn] || '';
                                if (fnsku.toString().trim()) {
                                    const customText = customTextColumn ? (row[customTextColumn] || '') : '';
                                    const count = countColumn ? (row[countColumn] || 1) : 1;
                                    
                                    batchLines.push(`${fnsku}:${customText}:${count}`);
                                }
                            });
                            
                            if (batchLines.length > 0) {
                                // æ›´æ–°æ‰¹é‡è¾“å…¥æ–‡æœ¬æ¡†
                                this.formData.batchInput = batchLines.join(', ');
                                // è§¦å‘æ•°æ®æ›´æ–°
                                this.updateBarcodeItemsFromBatchInput();
                                this.$message.success(`æˆåŠŸå¯¼å…¥${batchLines.length}æ¡æ•°æ®`);
                            } else {
                                this.$message.warning('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ•°æ®è¡Œ');
                            }
                        } catch (error) {
                            console.error('è§£æExcelæ–‡ä»¶å¤±è´¥:', error);
                            this.$message.error('è§£æExcelæ–‡ä»¶å¤±è´¥ï¼š' + error.message);
                        } finally {
                            this.loading = false;
                        }
                    };
                    
                    reader.onerror = () => {
                        this.$message.error('è¯»å–æ–‡ä»¶å¤±è´¥');
                        this.loading = false;
                    };
                    
                    reader.readAsArrayBuffer(file);
                },
                
                // æ›´æ–°å•ä¸ªé¡¹ç›®çš„é¢„è§ˆ
                updateItemPreview(index) {
                    const item = this.barcodeItems[index];
                    const canvas = document.getElementById('preview-' + index);
                    if (!canvas) return;
                    
                    const ctx = canvas.getContext('2d');
                    
                    // æ¸…é™¤ç”»å¸ƒ
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // å¦‚æœæ²¡æœ‰FNSKUï¼Œä¸ç”Ÿæˆæ¡å½¢ç 
                    if (!item.fnsku) return;
                    
                    // è®¡ç®—å®é™…å°ºå¯¸ï¼ˆ1mm = 10pxç”¨äºé¢„è§ˆï¼‰
                    const boxWidth = 500; // 50mm * 10px/mm
                    const boxHeight = 300; // 30mm * 10px/mm
                    const barcodeWidth = 460; // 46mm * 10px/mm
                    const barcodeHeight = 150; // 15mm * 10px/mm
                    
                    // è®¡ç®—æ¡å½¢ç ä½ç½®
                    const xOffset = (canvas.width - boxWidth) / 2;
                    const yOffset = (canvas.height - boxHeight) / 2;
                    const barcodeX = xOffset + (boxWidth - barcodeWidth) / 2;
                    const barcodeY = yOffset + (boxWidth - barcodeWidth) / 2;
                    
                    // ç”Ÿæˆæ¡å½¢ç 
                    this.generateBarcodeImage(item.fnsku, barcodeX, barcodeY, barcodeWidth, barcodeHeight, canvas);
                    
                    // ç»˜åˆ¶æ–‡æœ¬ï¼ˆFNSKUï¼‰
                    const fnskuTextY = yOffset + 20 + barcodeHeight + 30;
                    // é¢„è§ˆæ•ˆæœçš„æ–‡å­—æ˜¾ç¤ºå¢å¤§2.5å€
                    this.drawText(item.fnsku, xOffset + boxWidth/2 + (item.fnskuX || 0) * 0.265, fnskuTextY + (item.fnskuY || 0) * 0.265, 'center', item.fnskuFontSize * 2.5, canvas);
                    
                    // ç»˜åˆ¶è‡ªå®šä¹‰å†…å®¹
                    let currentY = fnskuTextY;
                    if (item.customTexts) {
                        currentY += 38;
                        this.drawText(item.customTexts, xOffset + boxWidth/2 + (item.fnskuX || 0) * 0.265, currentY + (item.fnskuY || 0) * 0.265, 'center', item.fnskuFontSize * 2.5, canvas);
                    }
                    
                    // ç»˜åˆ¶æ•°é‡
                    if (item.quantity) {
                        currentY += 38;
                        this.drawText(item.quantity, xOffset + boxWidth/2 + (item.fnskuX || 0) * 0.265, currentY + (item.fnskuY || 0) * 0.265, 'center', item.fnskuFontSize * 2.5, canvas);
                    }
                },
                
                // ç”Ÿæˆæ¡å½¢ç å›¾åƒ
                generateBarcodeImage(data, x, y, width, height, canvas) {
                    // åˆ›å»ºä¸´æ—¶canvasç”¨äºç”Ÿæˆæ¡å½¢ç 
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = width;
                    tempCanvas.height = height;
                    
                    // è®¾ç½®ä¸´æ—¶canvasèƒŒæ™¯ä¸ºç™½è‰²
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCtx.fillStyle = '#FFFFFF';
                    tempCtx.fillRect(0, 0, width, height);
                    
                    // ä½¿ç”¨JsBarcodeç”Ÿæˆæ¡å½¢ç 
                    JsBarcode(tempCanvas, data, {
                        format: 'CODE128',
                        width: 2,
                        height: height,
                        displayValue: false,
                        margin: 0,
                        backgroundColor: '#FFFFFF'
                    });
                    
                    // å°†ä¸´æ—¶canvasçš„å†…å®¹ç»˜åˆ¶åˆ°ä¸»canvasä¸Š
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(tempCanvas, x, y, width, height);
                },
                
                // ç»˜åˆ¶æ–‡æœ¬
                drawText(text, x, y, align, fontSize, canvas) {
                    const ctx = canvas.getContext('2d');
                    
                    // ä½¿ç”¨æ”¯æŒä¸­æ–‡çš„å­—ä½“å †æ ˆ
                    ctx.font = fontSize + "px 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', Arial, sans-serif";
                    ctx.textAlign = align;
                    ctx.fillStyle = '#000';
                    ctx.fillText(text, x, y);
                },
                
                // ä¸‹è½½æ‰€æœ‰PNGå›¾ç‰‡
                downloadAllImages() {
                    if (this.barcodeItems.length === 0) return;
                    
                    this.loading = true;
                    
                    setTimeout(() => {
                        try {
                            if (this.barcodeItems.length === 1) {
                                // å•ä¸ªå›¾ç‰‡ç›´æ¥ä¸‹è½½
                                this.downloadSingleImage(this.barcodeItems[0], 0);
                            } else {
                                // å¤šä¸ªå›¾ç‰‡æ‰“åŒ…æˆZIPä¸‹è½½
                                this.downloadImagesAsZip();
                            }
                        } catch (error) {
                            this.$message.error('ä¸‹è½½å›¾ç‰‡å¤±è´¥ï¼š' + error.message);
                            console.error('å›¾ç‰‡ä¸‹è½½é”™è¯¯:', error);
                        } finally {
                            this.loading = false;
                        }
                    }, 100);
                },
                
                // ä¸‹è½½å•ä¸ªPNGå›¾ç‰‡
                downloadSingleImage(item, index) {
                    const canvas = document.getElementById('preview-' + index);
                    if (!canvas) return;
                    
                    // è·å–å›¾ç‰‡æ•°æ®
                    canvas.toBlob((blob) => {
                        // ç”Ÿæˆæ–‡ä»¶åï¼šè‡ªå®šä¹‰æ–‡æœ¬#FNSKU#æ•°é‡
                        const customText = item.customTexts || 'unnamed';
                        const fnsku = item.fnsku || 'unknown';
                        const count = item.count || 1;
                        const fileName = `${customText}#${fnsku}#${count}.png`;
                        saveAs(blob, fileName);
                    });
                },
                
                // ä¸‹è½½å¤šä¸ªPNGå›¾ç‰‡ä¸ºZIP
                downloadImagesAsZip() {
                    const zip = new JSZip();
                    const imagesFolder = zip.folder("barcode_images");
                    const promises = [];
                    
                    // ä¸ºæ¯ä¸ªæ¡å½¢ç åˆ›å»ºå›¾ç‰‡å¹¶æ·»åŠ åˆ°ZIP
                    this.barcodeItems.forEach((item, index) => {
                        const promise = new Promise((resolve) => {
                            const canvas = document.getElementById('preview-' + index);
                            if (!canvas) {
                                resolve();
                                return;
                            }
                            
                            canvas.toBlob((blob) => {
                            // ç”Ÿæˆæ–‡ä»¶åï¼šè‡ªå®šä¹‰æ–‡æœ¬#FNSKU#æ•°é‡
                            const customText = item.customTexts || 'unnamed';
                            const fnsku = item.fnsku || 'unknown';
                            const count = item.count || 1;
                            const fileName = `${customText}#${fnsku}#${count}.png`;
                            imagesFolder.file(fileName, blob);
                            resolve();
                        });
                        });
                        promises.push(promise);
                    });
                    
                    // ç­‰å¾…æ‰€æœ‰å›¾ç‰‡å¤„ç†å®Œæˆåç”ŸæˆZIP
                    Promise.all(promises).then(() => {
                        zip.generateAsync({type: "blob"}).then((content) => {
                            const fileName = 'barcode_images_' + Date.now() + '.zip';
                            saveAs(content, fileName);
                            
                            this.$message({
                                type: 'success',
                                message: `æˆåŠŸç”ŸæˆåŒ…å« ${this.barcodeItems.length} ä¸ªå›¾ç‰‡çš„ZIPå‹ç¼©åŒ…`
                            });
                        });
                    });
                },
                
                // ç”Ÿæˆå¹¶ä¸‹è½½æ‰€æœ‰PDF
                generateAllPDFs() {
                    this.loading = true;
                    
                    // ä½¿ç”¨setTimeouté¿å…UIé˜»å¡
                    setTimeout(() => {
                        try {
                            if (this.barcodeItems.length === 1) {
                                // å•ä¸ªPDFç›´æ¥ä¸‹è½½
                                this.generateSinglePDF(this.barcodeItems[0], 0);
                                this.$message({
                                    type: 'success',
                                    message: 'æˆåŠŸç”ŸæˆPDFæ–‡ä»¶'
                                });
                            } else {
                                // å¤šä¸ªPDFæ‰“åŒ…æˆZIPä¸‹è½½
                                this.generatePDFsAsZip();
                            }
                        } catch (error) {
                            this.$message.error('ç”ŸæˆPDFå¤±è´¥ï¼š' + error.message);
                            console.error('PDFç”Ÿæˆé”™è¯¯:', error);
                        } finally {
                            this.loading = false;
                        }
                    }, 100);
                },
                
                // ç”Ÿæˆå¤šä¸ªPDFä¸ºZIP
                generatePDFsAsZip() {
                    const zip = new JSZip();
                    const pdfsFolder = zip.folder("barcode_pdfs");
                    const promises = [];
                    
                    // ä¸ºæ¯ä¸ªæ¡å½¢ç åˆ›å»ºPDFå¹¶æ·»åŠ åˆ°ZIP
                    this.barcodeItems.forEach((item, index) => {
                        const promise = new Promise((resolve) => {
                            try {
                                const { jsPDF } = window.jspdf || window;
                                const doc = new jsPDF({
                                    orientation: 'l',
                                    unit: 'mm',
                                    format: [50.5, 30.5] // å®½åº¦50.5mmï¼Œé«˜åº¦30.5mm
                                });
                                
                                // è®¡ç®—PDFä¸­çš„ä½ç½®
                                const barcodeBoxWidth = 50;
                                const barcodeBoxHeight = 30;
                                const barcodeWidth = 46;
                                const barcodeHeight = 15;
                                const x = 0.25; // ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œç•™å‡º0.25mmè¾¹è·
                                const y = 0.25; // ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œç•™å‡º0.25mmè¾¹è·
                                
                                // åƒç´ åˆ°æ¯«ç±³çš„è½¬æ¢ç³»æ•°
                                const pxToMm = 1 / 3.7795;
                                
                                // åˆ›å»ºä¸´æ—¶canvasç”¨äºç”Ÿæˆæ¡å½¢ç å›¾ç‰‡
                                const tempCanvas = document.createElement('canvas');
                                tempCanvas.width = barcodeWidth * 10; // 10px/mm
                                tempCanvas.height = barcodeHeight * 10;
                                
                                // è®¾ç½®ä¸´æ—¶canvasèƒŒæ™¯ä¸ºç™½è‰²
                                const tempCtx = tempCanvas.getContext('2d');
                                tempCtx.fillStyle = '#FFFFFF';
                                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                                
                                // ç”Ÿæˆæ¡å½¢ç 
                                JsBarcode(tempCanvas, item.fnsku, {
                                    format: 'CODE128',
                                    width: 2,
                                    height: barcodeHeight * 10,
                                    displayValue: false,
                                    margin: 0,
                                    backgroundColor: '#FFFFFF'
                                });
                                
                                // å°†æ¡å½¢ç è½¬æ¢ä¸ºDataURLå¹¶æ·»åŠ åˆ°PDF
                                const imgData = tempCanvas.toDataURL('image/png');
                                const barcodeX = x + (barcodeBoxWidth - barcodeWidth) / 2;
                                const barcodeY = y + (barcodeBoxWidth - barcodeWidth) / 2;
                                doc.addImage(imgData, 'PNG', barcodeX, barcodeY, barcodeWidth, barcodeHeight);
                                
                                // æ·»åŠ æ–‡æœ¬
                                const fnskuTextY = y + 2 + barcodeHeight + 3;
                                doc.setFontSize(item.fnskuFontSize * 0.7);
                                doc.text(item.fnsku, x + barcodeBoxWidth/2 + (item.fnskuX || 0) * pxToMm, fnskuTextY + (item.fnskuY || 0) * pxToMm, { align: 'center' });
                                
                                // ç»˜åˆ¶è‡ªå®šä¹‰å†…å®¹
                                let currentY = fnskuTextY;
                                
                                // ç»˜åˆ¶customTextså€¼
                                if (item.customTexts) {
                                    currentY += 4;
                                    doc.setFontSize(item.fnskuFontSize * 0.7); // ä½¿ç”¨ä¸FNSKUç›¸åŒçš„å­—ä½“å¤§å°
                                    doc.text(item.customTexts, x + barcodeBoxWidth/2 + (item.fnskuX || 0) * pxToMm, currentY + (item.fnskuY || 0) * pxToMm, { align: 'center' });
                                }
                                
                                // ç»˜åˆ¶æ•°é‡
                                if (item.quantity) {
                                    currentY += 4;
                                    doc.setFontSize(item.fnskuFontSize * 0.7); // ä½¿ç”¨ä¸FNSKUç›¸åŒçš„å­—ä½“å¤§å°
                                    doc.text(item.quantity, x + barcodeBoxWidth/2 + (item.fnskuX || 0) * pxToMm, currentY + (item.fnskuY || 0) * pxToMm, { align: 'center' });
                                }
                                
                                // ç”Ÿæˆæ–‡ä»¶åï¼šè‡ªå®šä¹‰æ–‡æœ¬#FNSKU#æ•°é‡
                                const customText = item.customTexts || 'unnamed';
                                const fnsku = item.fnsku || 'unknown';
                                const count = item.count || 1;
                                const fileName = `${customText}#${fnsku}#${count}.pdf`;
                                
                                // jsPDFçš„outputæ–¹æ³•ç›´æ¥è¿”å›ç»“æœï¼Œä¸è¿”å›Promise
                                const buffer = doc.output('arraybuffer');
                                pdfsFolder.file(fileName, buffer);
                                
                                // ç«‹å³resolveå½“å‰Promise
                                resolve();
                            } catch (error) {
                                console.error('ç”Ÿæˆå•ä¸ªPDFæ—¶å‡ºé”™:', error);
                                resolve(); // å³ä½¿å‡ºé”™ä¹Ÿç»§ç»­å¤„ç†å…¶ä»–PDF
                            }
                        });
                        promises.push(promise);
                    });
                    
                    // ç­‰å¾…æ‰€æœ‰PDFå¤„ç†å®Œæˆåç”ŸæˆZIP
                    Promise.all(promises).then(() => {
                        zip.generateAsync({type: "blob"}).then((content) => {
                            const fileName = 'barcode_pdfs_' + Date.now() + '.zip';
                            saveAs(content, fileName);
                            
                            this.$message({
                                type: 'success',
                                message: `æˆåŠŸç”ŸæˆåŒ…å« ${this.barcodeItems.length} ä¸ªPDFæ–‡ä»¶çš„ZIPå‹ç¼©åŒ…`
                            });
                        });
                    });
                },
                
                // ç”Ÿæˆå•ä¸ªPDF
                generateSinglePDF(item, index) {
                    // åˆ›å»ºPDFæ–‡æ¡£
                    const { jsPDF } = window.jspdf || window;
                    const doc = new jsPDF({
                        orientation: 'l',
                        unit: 'mm',
                        format: [50.5, 30.5] // å®½åº¦50.5mmï¼Œé«˜åº¦30.5mm
                    });
                    
                    // è®¡ç®—PDFä¸­çš„ä½ç½®
                    const barcodeBoxWidth = 50;
                    const barcodeBoxHeight = 30;
                    const barcodeWidth = 46;
                    const barcodeHeight = 15;
                    const x = 0.25; // ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œç•™å‡º0.25mmè¾¹è·
                    const y = 0.25; // ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œç•™å‡º0.25mmè¾¹è·
                    
                    // åƒç´ åˆ°æ¯«ç±³çš„è½¬æ¢ç³»æ•°
                    const pxToMm = 1 / 3.7795;
                    
                    // åˆ›å»ºä¸´æ—¶canvasç”¨äºç”Ÿæˆæ¡å½¢ç å›¾ç‰‡
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = barcodeWidth * 10; // 10px/mm
                    tempCanvas.height = barcodeHeight * 10;
                    
                    // è®¾ç½®ä¸´æ—¶canvasèƒŒæ™¯ä¸ºç™½è‰²
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCtx.fillStyle = '#FFFFFF';
                    tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                    
                    // ç”Ÿæˆæ¡å½¢ç 
                    JsBarcode(tempCanvas, item.fnsku, {
                        format: 'CODE128',
                        width: 2,
                        height: barcodeHeight * 10,
                        displayValue: false,
                        margin: 0,
                        backgroundColor: '#FFFFFF'
                    });
                    
                    // å°†æ¡å½¢ç è½¬æ¢ä¸ºDataURLå¹¶æ·»åŠ åˆ°PDF
                    const imgData = tempCanvas.toDataURL('image/png');
                    const barcodeX = x + (barcodeBoxWidth - barcodeWidth) / 2;
                    const barcodeY = y + (barcodeBoxWidth - barcodeWidth) / 2;
                    doc.addImage(imgData, 'PNG', barcodeX, barcodeY, barcodeWidth, barcodeHeight);
                    
                    // æ·»åŠ æ–‡æœ¬
                    const fnskuTextY = y + 2 + barcodeHeight + 3;
                    doc.setFontSize(item.fnskuFontSize * 0.7);
                    doc.text(item.fnsku, x + barcodeBoxWidth/2 + (item.fnskuX || 0) * pxToMm, fnskuTextY + (item.fnskuY || 0) * pxToMm, { align: 'center' });
                    
                    // ç»˜åˆ¶è‡ªå®šä¹‰å†…å®¹
                    let currentY = fnskuTextY;
                    
                    // ç»˜åˆ¶customTextså€¼
                    if (item.customTexts) {
                        currentY += 4;
                        doc.setFontSize(item.fnskuFontSize * 0.7); // ä½¿ç”¨ä¸FNSKUç›¸åŒçš„å­—ä½“å¤§å°
                        doc.text(item.customTexts, x + barcodeBoxWidth/2 + (item.fnskuX || 0) * pxToMm, currentY + (item.fnskuY || 0) * pxToMm, { align: 'center' });
                    }
                    
                    // ç»˜åˆ¶æ•°é‡
                    if (item.quantity) {
                        currentY += 4;
                        doc.setFontSize(item.fnskuFontSize * 0.7); // ä½¿ç”¨ä¸FNSKUç›¸åŒçš„å­—ä½“å¤§å°
                        doc.text(item.quantity, x + barcodeBoxWidth/2 + (item.fnskuX || 0) * pxToMm, currentY + (item.fnskuY || 0) * pxToMm, { align: 'center' });
                    }
                    
                    // ä¸‹è½½PDFï¼ˆåªåœ¨å•æ–‡ä»¶æƒ…å†µä¸‹è°ƒç”¨ï¼‰
                    // ç”Ÿæˆæ–‡ä»¶åï¼šè‡ªå®šä¹‰æ–‡æœ¬#FNSKU#æ•°é‡
                    const customText = item.customTexts || 'unnamed';
                    const fnsku = item.fnsku || 'unknown';
                    const count = item.count || 1;
                    const fileName = `${customText}#${fnsku}#${count}.pdf`;
                    doc.save(fileName);
                }
            }
        });
    </script>
</body>
</html>